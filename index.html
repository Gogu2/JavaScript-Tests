<html></html>
<head>
v 17.0
<script type="text/javascript">

const gameSpeed = 60;//60
const gameExplosionDuration = 20;
const gameKirbyIdlingTime = 20;
const gameKirbyFrozenTime = 20;

const KEY_DELETE = 46;
const KEY_ENTER = 13;
const KEY_RIGHT = 39;
const KEY_LEFT = 37;
const KEY_CTRL = 17;
const KEY_SPACE = 32;


var groundy = 375; 
var v0yinitial = -75;
var gameKeys; 
var speedx=0;

var world = 1;

var idling;
var timerstopped = 0;
var kirbyinitialheight = 54;
var kirbyFrozen = false;
var kirbyFrozenCounter = 0;


//var angleE = 0;
var angleK = new Array(0,0,0,0,0,0,0,0,0,0);
var xbombkirby = new Array(0,0,0,0,0,0,0,0,0,0);
var ybombkirby = new Array(0,0,0,0,0,0,0,0,0,0);
var bombNo = 0;
var enemywidth = 75;
var xexplosion = 0;
var yexplosion = 0;
var timerexplosion = 0;
var lifePiece = 10;
var whispyAlive = true;
var whispyLife = 3;
var whispyFrozen = 0;

   var soundObject = null;
        function playSound(soundfile) {
            if (soundObject != null) {
                document.body.removeChild(soundObject);
                soundObject.removed = true;
                soundObject = null;
            }
            soundObject = document.createElement("embed");
            soundObject.setAttribute("src", "sounds/"+soundfile);
            soundObject.setAttribute("hidden", true);
            soundObject.setAttribute("autostart", true);
			soundObject.setAttribute("loop", true);
            document.body.appendChild(soundObject);
        }


var funcSetInterval;
var map = {};

//var soundjump = new Audio('sounds/jump.mp3');

var firewidth = 191;
var fireheight = 55;

var icewidth = 105;
var iceheight = 30;

var bombheight = 54;
var bombwidth = 54;

var spitwidth = 37;
var spitheight = 17;

var startspitting = []; //5
	var spitdirection = []; //new int[5];

  var xspit = []; //5
	var yspit = []; //5

	var enemymouthy = 30;
	var startspittingkirby;
	var xspitkirby = new Array(0,0,0,0,0,0,0,0,0,0);
	var yspitkirby = new Array(0,0,0,0,0,0,0,0,0,0);
	var spitdirectionkirby  = 0;
	var bombdirectionkirby = [];
	var kirbydirection;

  var aspiring = [];
  var aspiringrange = 200;



  var platformwidth = Array(10000, 123, 123, 123, 123 );
	var aspiring = Array(0,0,0,0,0,0);

  var doorwidth = 75;
	var doorHeight = 75;

	var xcaged; // = 600;
	var ycaged = 0;
	var cagedwidth = 75;
	var cagedheight = 75;
	var cagedReleased = 0;

  var img;
  var imgBandana;
  var imgEnemyLeft;
  var imgDoor;
  var imgCoin;
  var imgCurrent;
  var imgCurrentBandana;
  var imgBandana;
  var imgPlatform;
  var imgBlankForPlatform;
  var imgEnemyCurrent = Array(0,0,0,0);

    var hashat=0;
	var hasbomb = 0;
	var hasice = 0;
	  var kirbywidth = 75;
	  var bandanawidth =75;
	 
	  var screenwidth = 640;
    
    var applewidth = 89;
	var appleheight = 84;
	var coinwidth = 75;
	var kirbywidth = 47;// 75;
	var bandanawidth = 50;
	var bandanaheight = 75;
	
	var kirbyinitialheight = 54;
	var kirbyheight = 54;// 75;
	var screenwidth = 640;

	var kirbyfirewidth = 47;
	var kirbyfireheight = 86;
	var kirbybombheight = 96;
	var kirbyiceheight = 86;

	var xinit = 15; //0  
	var yinit = groundy - kirbyinitialheight;//321;

  // kirby
	var xkirby = xinit;
	var y0 = 321;
	var ykirby = y0;
	var v0y = v0yinitial; // 75
	var vy = v0y;

	
    
// kirby
var onmovingplatform = 0;
	var jumpstarted = 0;
	var jumpleft = 0;
	var jumpright = 0;
	var t = 0;
	var idletime = 0;
	var onplatform = 1;
	var fallstart = 0;
	var jumpfromplatform = 0;
	var coinsTaken = 0;

   // bandana
	var xb = screenwidth - 75;
	var yb0 = 300;
	var yb = yb0;
	var vb0y = -75; // 75
	var vby = vb0y;

	var xbinit = screenwidth - 75;
	var ybinit = 300;

  
    
    //enemy
    //var xe = 500;
    //var ye = 300;

   // var maxLevel = 3;
   var maxLevel = 9;
   var firstworldmaxlevel = 7;


var coinAlive = [];
coinAlive = new Array(4).fill(1).map(() => new Array(maxLevel + 1).fill(1));

    var platformrange = 200;

var xplatform = [];
xplatform = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
var yplatform = [];
yplatform = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));


    var angleE = new Array(0,0,0,0);
    const nrcoins = new Array( 0, 3, 3, 3, 0, 0, 0, 0 , 3, 3);
	  const nrplatforms = new Array( 0, 3, 3, 3, 3, 3, 3 , 0, 3, 3, 0);

    var movingplatform = [];
    movingplatform = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));


   var platformmaxx = [];
   platformmaxx = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   var platformminx = [];
   platformminx = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   var platformdirection = [];
   platformdirection = new Array(4).fill(0).map(() => new Array(maxLevel+1).fill(0));

   var enemyheight = 75;
   var enemymaxx=[];
   enemymaxx = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   
   var enemyminx = [];
   enemyminx = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   
   var xe= [];
   xe= new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   
   var ye= [];
   ye= new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));

   var enemydirection = [];
   enemydirection = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   
   var enemyExists = [];
   enemyExists = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
   
   var enemySpitting = [];
   enemySpitting = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));

   var enemyBomb = [];
   enemyBomb = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));

   var enemyIce = [];
   enemyIce = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));

   var enemyFrozen = [];
   enemyFrozen = new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));

    
    var platformheight =53;
   
    
  var coiny = [];
  coiny =  new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
  var coinx = [];
  coinx =  new Array(4).fill(0).map(() => new Array(maxLevel + 1).fill(0));
    
    const xDoor = new Array(0,0,0);
    const yDoor = new Array(0,0,0);
    var doorwidth = 75;
    var platform=0;
    var platformb = 0;
  
    
    //kirby
    var booljumpstarted = 0;
    var booljumpleft = 0;
    var booljumpright = 0;

    var t = 0;
    var idletime = 0;
    
    var boolonplatform = 1;
    var boolfallstart = 0;
    var booljumpfromplatform = false;
    var coinsTaken = 0;
   
   // bandana
	var onmovingplatformb = 0;
	var jumpstartedb = 0;
	var jumpleftb = 0;
	var jumprightb = 0;
	var tb = 0;
	var idletimeb = 0;
	var onplatformb = 1;
	var fallstartb = 0;
	var jumpfromplatformb = 0;
	var coinsTakenb = 0;
    

    
    
    //var coins = 3;
  
    
    
    var gravity = 3; //10
    
    
   
    
    
      var bool_moveLeft;
        var bool_moveRight;
        
        var  bool_moveLeftb;
        var bool_moveRightb;
        
   //enemy
  
  // var boolenemyExists = false;
   var boolenemyDied = false;
   
   var whispywidth = 511;
	var whispyheight = groundy;//269;
	
	var xwhispy=150;
	var ywhispy=y0+kirbyheight-whispyheight;
	var xwhispytree = 600;
	

	var x0apple = 150+Math.floor(Math.random() * 250); 
	var y0apple=75;//150
	var yapple = y0apple;
	var xapple = x0apple;
    
    var level; 
    
  function drawImage(idImage, xdraw, ydraw)
{
  const c = document.getElementById("canvas1");
  const ctx = c.getContext("2d");
  const img = document.getElementById(idImage);
  ctx.drawImage(img, xdraw, ydraw);
}

function drawRotatedBombK(xdraw, ydraw, angle)
{
	const c = document.getElementById("canvas1");
  	const ctx = c.getContext("2d");
  	if (angle == 0 ) 
		img = document.getElementById("imgBombK0");
	if (angle == 90)
	 img = document.getElementById("imgBombK90");
	if (angle == 180)
		img = document.getElementById("imgBombK180");
	if  (angle == 270)
		img = document.getElementById("imgBombK270");
	
  	ctx.drawImage(img, xdraw, ydraw);
}

function drawRotatedBombE(xdraw, ydraw, angle)
{
	const c = document.getElementById("canvas1");
  	const ctx = c.getContext("2d");
  	if (angle == 0 ) 
		img = document.getElementById("imgBombE0");
	if (angle == 90)
	 img = document.getElementById("imgBombE90");
	if (angle == 180)
		img = document.getElementById("imgBombE180");
	if  (angle == 270)
		img = document.getElementById("imgBombE270");
	
  	ctx.drawImage(img, xdraw, ydraw);
}

/*
function drawImageAngle(idImage, xdraw, ydraw, angle)
{
	const c = document.getElementById("canvas1");
    const ctx = c.getContext("2d");
	const img = document.getElementById(idImage);
    ctx.save();
	ctx.translate(xdraw, ydraw);
	ctx.rotate(angle);
	ctx.translate(-(xdraw+bombheight/2),-(ydraw+bombheight/2));
	ctx.drawImage(img,xdraw, ydraw);
	ctx.restore();
}
*/

//var TO_RADIANS = Math.PI/180; 
/*
function drawRotatedImage_old(idImage, x, y, angle)
{ 
	const c = document.getElementById("canvas1");
    const context = c.getContext("2d");
	const img = document.getElementById(idImage);
    // save the current co-ordinate system 
    // before we screw with it
    context.save(); 

    // move to the middle of where we want to draw our image
    context.translate(x, y);

    // rotate around that point, converting our 
    // angle from degrees to radians 
    context.rotate(angle * TO_RADIANS);

    // draw it up and to the left by half the width
    // and height of the image 
    context.drawImage(image, -(image.width/2), -(image.height/2));

    // and restore the co-ords to how they were when we began
    context.restore(); 
}
*/

   
function collision_old(x1, width1, x2, width2, y1, height1, y2, height2)
  {
	var res = (
					Math.abs(x1 + width1 / 2 - (x2 + width2 / 2)) <= 25
					&& 
					Math.abs(y1 + height1 / 2 - (y2 + height2 / 2)) <= 25
		)

	return res;
  }
    
function collision(x1, width1, x2, width2, y1, height1, y2, height2)
{
	var res =
	(
		(x1+width1 >= x2 && x1+width1 <=x2+width2)
		||
		(x2+width2 >= x1 && x2+width2 <=x1+width1) 
	)
	&&
	(
		(y1+height1 >= y2 && y1+height1 <=y2+height2)
		||
		(y2+height2 >= y1 && y2+height2 <=y1+height1) 
	)

	return res;
}

function kirbyMovementEvents()
{
	if (!kirbyFrozen)
{
//move right
	if (!jumpright && !jumpstarted)
	if (gameKeys && !gameKeys[KEY_CTRL] && gameKeys[KEY_RIGHT]) 
	{
		idling = false;
		idletime = 0;

		kirbydirection = 1;
		setKirbyCurrentImage(0);
		/*
		
			*/
		bool_moveRight = 1;
		speedx = 10;		  
} 

//move left
	if (!jumpleft && !jumpstarted)
	if (gameKeys && !gameKeys[KEY_CTRL] && gameKeys[KEY_LEFT]) 
          {
			idling = false;
			idletime = 0;

            kirbydirection = -1;
			setKirbyCurrentImage(0);
			bool_moveLeft = 1;
			speedx = -10;
          }

   //jump right
		 //  if (!jumpstarted && !fallstart)
		 if (!jumpright)
          if (gameKeys && gameKeys[KEY_RIGHT] && gameKeys[KEY_CTRL] || gameKeys && gameKeys[KEY_CTRL] && bool_moveRight) 
          {
			idling = false;
			idletime = 0;

              kirbydirection = 1;
              v0y = v0yinitial;
              y0 = ykirby;

			  setKirbyCurrentImage(0);
              jumpstarted = 1;
              jumpright = 1;
              jumpleft = 0;
              if (onplatform)
                jumpfromplatform = 1;
              else
                jumpfromplatform = 0;
          		//Sorina playSound("jump.wav");
		      }

  //jump left
		 // if (!jumpstarted && !fallstart)
		 if (!jumpleft )
          if (gameKeys && gameKeys[KEY_CTRL] && gameKeys[KEY_LEFT] || gameKeys && gameKeys[KEY_CTRL] && bool_moveLeft) 
          {
				idling = false;
				idletime = 0;

                kirbydirection = -1;
                v0y = v0yinitial;
                y0 = ykirby;

				setKirbyCurrentImage(0);
                jumpstarted = 1;
                jumpleft = 1;
                jumpright = 0;
                if (onplatform)
                  jumpfromplatform = 1;
                else
                  jumpfromplatform = 0;
          }

		  //jump vertically
		if (!jumpstarted && !fallstart && !jumpleft && !jumpright)
		if (gameKeys && gameKeys[KEY_CTRL] && !gameKeys[KEY_LEFT] && !gameKeys[KEY_RIGHT])
		{
				idling = false;
				idletime = 0;

				kirbydirection = -1;
                v0y = v0yinitial;
                y0 = ykirby;

				jumpstarted = 1;
                jumpleft = 0;
                jumpright = 0;
                if (onplatform)
                  jumpfromplatform = 1;
                else
                  jumpfromplatform = 0;

		}

		_DoMovement();

	}
}

function setKirbyCurrentImage(aspiring)
{
	if (aspiring)
	{
		if (kirbydirection == 1)
		{
			imgCurrent = "imgAspiringRight";
		}
		else
		{
			imgCurrent = "imgAspiringLeft";
		}
		return;
	}

	if (kirbydirection == 0)
	{
			if(!hashat && !hasbomb && !hasice)
			{
				imgCurrent = "img";
			}

			if (hashat) 
			{
				imgCurrent = "imgKirbyFire";
			}
			if (hasbomb)
			{
			
				imgCurrent = "imgKirbyBomb";
			}
			if(hasice)
			{
		
				imgCurrent = "imgKirbyIce";
			}
	}

	if (kirbydirection == 1)
	{
		if (!hashat && !hasbomb && !hasice)
		{	
			imgCurrent = "imgKirbyRight";
		}
		if (hashat)
		{
			imgCurrent = "imgKirbyFireRight";
		}
		if (hasbomb)
		{
			imgCurrent = "imgKirbyBombRight";
		}
		if (hasice)
		{
			imgCurrent = "imgKirbyIceRight";
		}
	}

	if (kirbydirection == -1)
	{
		if (!hashat && !hasbomb && !hasice)
		{	
			imgCurrent = "imgKirbyLeft";
		}
		if (hashat)
		{
			imgCurrent = "imgKirbyFireLeft";
		}
		if (hasbomb)
		{
			imgCurrent = "imgKirbyBombLeft";
		}
		if (hasice)
		{
			imgCurrent = "imgKirbyIceLeft";
		}
	}

} //end setKirbyCurrentImage

function gameLoop() 
    {

	//
	speedx = 0;

	kirbyMovementEvents();

	//clear screen
			c = document.getElementById("canvas1");
			context = c.getContext("2d");
			context.clearRect(0, 0, document.getElementById("canvas1").width, document.getElementById("canvas1").height);
	//

		// game over
		if (document.getElementById("lifeKirby").getAttribute('value') <= 0 || document.getElementById("pbBandana").getAttribute('value') <= 0)
		{
			clearInterval(funcSetInterval);
			timerstopped = 1;
      		drawImage("imgGameOver", 0, 0);
			return;
		}
		// end game over

		if (xexplosion!=0)
		{
			timerexplosion ++;
			if (timerexplosion == gameExplosionDuration)
			{
				timerexplosion = 0;
				xexplosion = 0;
			}
		}

		
		// idling
		idletime++;
		idletimeb++;
		if (!kirbyFrozen)
		if (idletime == gameKirbyIdlingTime)
		 {
			idling = true;
			kirbydirection = 0; //v11
			setKirbyCurrentImage(0);
		}

		idletimeb++;
		if (idletimeb == 20) {
		
			if (imgCurrentBandana == "imgBandana"){}
			else
			imgCurrentBandana = "imgBandana";
		}
		// end idling

		var yy = 0;
		var yyb = 0;

		if (world == 1)
			drawImage("imgGround", 0, groundy);
		if (world == 2)
			drawImage("imgWorld2", 0, groundy);

		doors();
		coins();

		// caged waddle dee
		cagedWaddleeDee();
		// end caged waddle dee

		platforms();
		enemy();
		if (level == firstworldmaxlevel)
		{
			whispywoods();
		}

		// enter kirby

		if (kirbyFrozen)
		{
			kirbyFrozenCounter++;
			if (kirbyFrozenCounter > gameKirbyFrozenTime)
			{
				kirbyFrozen = false;
				kirbyFrozenCounter = 0;
				setKirbyCurrentImage();
				if (hasice)
				{
					ykirby = ykirby - (kirbyiceheight - kirbyinitialheight);
				}
				if (hashat)
				{
					ykirby = ykirby - (kirbyfireheight - kirbyinitialheight);
				}
				if (hasbomb)
				{
					ykirby = ykirby - (kirbybombheight - kirbyinitialheight);
				}
			}
		}


		
		xkirby+=speedx;
		drawImage(imgCurrent, xkirby, ykirby);
	
		
		// enter bandana
		drawImage(imgCurrentBandana, xb, yb);

		// getting coins
		gettingCoins();

		// release waddlee dee
		kirbyReleasesWaddleeDee();
		//
		
		if (kirbyFindsDoor())
		{
			return;
		}
			

		jumpsfalls();


   } //end gameLoop()

function gettingCoins()
{
	for (var i = 0; i < nrcoins[level]; i++) 
		{
			// kirby
				if (coinAlive[i][level])
				if (collision(xkirby, kirbywidth, coinx[i][level], coinwidth, ykirby, kirbyheight, coiny[i][level], coinwidth))
				{
			
					playSound("coin3.wav");
			
					
					coinsTaken++;
					
					coinAlive[i][level] = 0;
					var c = coinsTaken + coinsTakenb;
					document.getElementById("lblCoins").innerText ="Coins: " + c;

				}

			// bandana
			if (collision(xb, bandanawidth, coinx[i][level], coinwidth, yb, bandanaheight, coiny[i][level], coinwidth))
			{
					playSound("coin3.wav");
				coinsTakenb++;
				
				c = coinsTaken + coinsTakenb;
				document.getElementById("lblCoins").innerText ="Coins: " + c;
			}
		}
}

function kirbyFindsDoor()
{
	if (!jumpstarted && !fallstart && collision(xkirby, kirbywidth, xDoor[level - 1], doorwidth, ykirby, kirbyheight, yDoor[level - 1], doorwidth)
				||
			collision(xb, bandanawidth, xDoor[level - 1], doorwidth, yb, bandanaheight, yDoor[level - 1], doorwidth)
				)

			if (level == maxLevel) 
			{
					clearInterval(funcSetInterval);
					timerstopped = 1;
          			drawImage("imgVictory", 0, 0);
					return 1;
			} 
			else 
			{
				if (level == firstworldmaxlevel) 
				{
					if (cagedReleased)
					{
						level++;
						jumpLevel();
						return 1;
					}
				}	
				else
				{
					level++;
					jumpLevel();
					return 1;
				}
			}
	return 0;
}

function cagedWaddleeDee()
{
	if (level == firstworldmaxlevel && !whispyAlive) 
		{
			cagedExists = 1;
		} else
		{
			cagedExists = 0;
		}

		if (cagedExists) 
		{
			xcaged = xDoor[level - 1] + 150;
			ycaged = yDoor[level - 1];
			drawImage(imgCurrentWaddle, xcaged, ycaged);
		}
}

function kirbyReleasesWaddleeDee()
{
	if (!whispyAlive)
		if (level == firstworldmaxlevel && !cagedReleased)
		
			if (collision(xkirby, kirbywidth, xcaged, cagedwidth, ykirby, kirbyheight, ycaged, cagedheight)
				||
				collision(xb, bandanawidth, xcaged, cagedwidth, yb, bandanaheight, ycaged, cagedheight)
				)
			{
				cagedReleased = true;
				imgCurrentWaddle = "imgFree";
				drawImage("imgFree", xcaged, ycaged);
				playSound("release.wav"); 
			}
}

function jumpLevel()
   {
					if (level >= firstworldmaxlevel+1)
					{
						world = 2;
					}
					else
					{
						world = 1;
					}
					initlevel();
				
					displayLevel((level-7*(world-1)));
					document.getElementById("lblWorld").innerText ="World: " + world;

					speedx = 0;
					bool_moveLeft = 0;
					//Sorina a scos playSound("release.wav"); 
   }
   
function jumpsfalls() {
		var yi = 0;
		var yib = 0;

		if (fallstart)
			fallkirby();
		if (jumpstarted)
			jumpkirby();

     
		if (fallstartb)
			fallbandana();
		if (jumpstartedb)
			jumpbandana();

		
	if(hashat)
		kirbyfire();
	if (hasbomb)
		kirbybomb();
	if(hasice)
		kirbyice();
	}

function kirbyfire()
	{
		var xfire;
		var yfire;
		if (startspittingkirby) 
		{
			if(kirbydirection == 0)
			{
				return;
			}
			if (kirbydirection == 1) 
			{
				drawImage("imgFireRight", xkirby+kirbywidth, ykirby+enemymouthy /*+enemymouthy*/);
			}
			if (kirbydirection == -1)
			{
				drawImage("imgFireLeft", xkirby-firewidth, ykirby+enemymouthy /*+enemymouthy*/);	
			}
				for (var i = 0;i<=3;i++) 
				{
					if(enemyExists[i][level])
					{
						if (kirbydirection == 1)
							xfire = xkirby+kirbywidth;
						else
							xfire = xkirby;
						yfire = ykirby+kirbyheight/2; 
						
						if (collision(xfire, firewidth, xe[i][level], enemywidth, yfire, fireheight, ye[i][level], enemyheight))
						{
							enemyExists[i][level] = false;
							playSound("die.wav");
						}
					}	
				}

				//shoot whispywoods
				if (level == firstworldmaxlevel)
						{
							if (xkirby+kirbywidth+firewidth+5 >= xwhispytree)
							{
								playSound("die.wav"); 
								whispyLife --;
							}
							if (whispyLife <= 0)
							{
								whispyAlive = false;
							}
						}

			
			
		}
	}

function kirbyice()
	{
		var xice;
		var yice;
		if (startspittingkirby) 
		{
			if(kirbydirection == 0)
			{
				return;
			}
			
			if (kirbydirection == 1) 
			{
				drawImage("imgIceRight", xkirby+kirbywidth, ykirby+enemymouthy /*+enemymouthy*/);
			}
			if (kirbydirection == -1)
			{
				drawImage("imgIceLeft", xkirby - icewidth, ykirby+enemymouthy);
			}
				for (var i = 0;i<=3;i++) 
				{
					if(enemyExists[i][level])
					if (kirbydirection == 1)
							xice = xkirby+kirbywidth;
						else
							xice = xkirby;
					yice = ykirby+kirbyheight/2; 
					if (collision(xice, icewidth, xe[i][level], enemywidth, yice, iceheight, ye[i][level], enemyheight))
					{
						enemyFrozen[i][level] = true;
							if (!enemyIce[i][level] && !enemyBomb[i][level] && !enemySpitting[i][level])
							if (enemydirection[i][level] = 1)
								imgEnemyCurrent[i] = "imgRightFrozen";
							else
								imgEnemyCurrent[i] = "imgLeftFrozen";
							if (enemySpitting[i][level] && !(enemyBomb[i][level]) && !(enemyIce[i][level]))
							{
								imgEnemyCurrent[i] = "imgHotHeadFrozen";
							}
							if(enemyBomb[i][level])
							{
								imgEnemyCurrent[i] = "imgPoppyFrozen";
							}

							playSound("explosion.wav");  
							
							if (enemySpitting[i][level])
							{
								startspitting[i] = 0;
							}
							
								
							startspittingkirby = false;
					}
						
				}

				//freeze whispywoods
				if (level == firstworldmaxlevel)
						{
							if (xkirby+kirbywidth+191+5 >= xwhispytree)
							{
								//playSound("die.wav"); 
								//whispyLife --;
								whispyFrozen = 1;
							}
							
						}
			}
			
		}
	

/*
function sleep(miliseconds) 
	{
   		var currentTime = new Date().getTime();

   	while (currentTime + miliseconds >= new Date().getTime())
	 {
   	 }
	}
*/

function kirbybomb()
	{

					if (startspittingkirby) 
					for (var k = 1; k<=bombNo;k++)
					{
						

						xbombkirby[k] += 10 * bombdirectionkirby[k];

						angleK[k] += 90;
						if (angleK[k] == 360)
							angleK[k] = 0;
						
						drawRotatedBombK( xbombkirby[k], ybombkirby[k], angleK[k]);
						

						
						//shoot whispywoods
						if (level == firstworldmaxlevel)
						{
							if ((xbombkirby[k] + bombwidth/2) >= xwhispytree)
							{
								playSound("explosion.wav"); 
								startspittingkirby[k] = false;
								whispyLife --;
							}
							if (whispyLife <= 0)
							{
								
								whispyAlive = false;
							}
						}

						// shoot enemy
						for(var i = 0;i<=3;i++)
						if (enemyExists[i][level])
						{
						if (Math.abs(xe[i][level] + enemywidth / 2 - (xbombkirby[k] + bombwidth/2)) <= 10
								&& Math.abs(ye[i][level] + enemyheight / 2 - (ybombkirby[k] + bombheight/2)) <= 40) 
						{
							drawImage("imgExplosion", xe[i][level], ye[i][level]);
							playSound("explosion.wav"); 
							xexplosion = xe[i][level];
							yexplosion = ye[i][level];
							
							enemyExists[i][level] = 0;
							if (enemySpitting[i][level])
							{
								startspitting[i] = 0;
							
							}
							
							bombNo--;
							if (bombNo == 0) 
								startspittingkirby = false;
						}
					}

						
						if (xbombkirby[k] < 0 || xbombkirby[k] > screenwidth) 
						{

							
							bombNo--;
							if (bombNo == 0) 
								startspittingkirby = false;
						}

					}
					//
	}

 function fallbandana() {
		var yib = 0;

		onmovingplatformb = 0;
		onplatformb = 0;
		

		tb = tb + 1;
		
		vby = (gravity * tb * tb) / 2;

		yib = yb;
		yb = yb0 + vby * tb;

		// fall on a lower platform ?
		for (var i = 0; i < 4; i++) {
			// debug if (platform != i)
			if ((xb >= xplatform[i][level] - 35) && (xb + kirbywidth <= xplatform[i][level] + platformwidth[i] + 35))
				// debug if ((y0+vy*t+kirbywidth >=yplatform[i]-35) && (y0+vy*t+kirbywidth <=
				// yplatform[i]+35))
				if (yib + bandanaheight <= yplatform[i][level] && yb + bandanaheight >= yplatform[i][level]) {
					yb = yplatform[i][level] - bandanaheight;
					onplatformb = 1;
					platformb = i;
					jumpstartedb = 0;
					fallstartb = 0;
					tb = 0;
					vby = vb0y;
					if (movingplatform[i][level]) {
						onmovingplatformb = 1;
					}
				}
		}
		//

		drawImage(imgCurrentBandana, xb, yb);
		return;

	}

	function jumpbandana() {
		var yib = 0;

		

		onmovingplatformb = false;
		onplatformb = false;

		tb = tb + 1;
		vby = vb0y + (gravity * tb * tb) / 2;

		yib = yb;
		yb = yb0 + vby * tb;
		// y = y+vy*t;

		if (jumprightb) 
		{
			if (xb + kirbywidth >= screenwidth) 
			{
				xb = screenwidth - kirbywidth;
			} else
				xb = xb + 35;
		}
		if (jumpleftb) 
		{
			if (xb <= 0) 
			{
				xb = 0;
			} else
				xb = xb - 35;
		}

		// jump on platform ?
		for (var i = 0; i < 4; i++) {
			// if (platform != i)
			if ((xb >= xplatform[i][level] - 35) && (xb + bandanawidth <= xplatform[i][level] + platformwidth[i] + 35))
				// debug if ((y0+vy*t+kirbywidth >=yplatform[i]-35) && (y0+vy*t+kirbywidth <=
				// yplatform[i]+35))
				if (yib + bandanaheight <= yplatform[i][level] && yb + bandanaheight >= yplatform[i][level]) {
					yb = yplatform[i][level] - bandanaheight;
					onplatformb = 1;
					platformb = i;
					jumpstartedb = 0;
					tb = 0;
					vby = vb0y;
					if (movingplatform[i][level]) {
						onmovingplatformb = 1;
					}
				}
		}

		// jump up into ceiling ?
		for (var i = 0; i < 4; i++) {
			if ((xb >= xplatform[i][level] - 35) && (xb + bandanawidth <= xplatform[i][level] + platformwidth[i] + 35))
				if (yib >= yplatform[i][level] + platformheight && yb <= yplatform[i][level] + platformheight) {
					yb = yplatform[i][level] + platformheight;
					jumpstartedb = 0;
					tb = 0;
					vby = 0;
					fallstartb = 1;
				}
		}

		// end ceiling

		drawImage(imgCurrentBandana, xb, yb);
		//getContentPane().repaint(); // don't forget to repaint the container

	}


   function fallkirby() 
   {
		var yi = 0;
		// y+=10;
		onmovingplatform = false;
		onplatform = false;
			

		t = t + 1;
		
		vy = (gravity * t * t) / 2;

		yi = ykirby;
		ykirby = y0 + vy * t;

		// fall on a lower platform ?
		for (var i = 0; i <= nrplatforms[level]; i++) {
			// debug if (platform != i)
			if ((xkirby >= xplatform[i][level] - 35)
					&& (xkirby + kirbywidth <= xplatform[i][level] + platformwidth[i] + 35))
				// debug if ((y0+vy*t+kirbywidth >=yplatform[i]-35) && (y0+vy*t+kirbywidth <=
				// yplatform[i]+35))
				if (yi +kirbyheight <= yplatform[i][level] && ykirby + kirbyheight >= yplatform[i][level]) {
					ykirby = yplatform[i][level] - kirbyheight;
					onplatform = 1;
					platform = i;
					jumpstarted = 0;
					jumpleft = 0;jumpright = 0; //v2
					fallstart = 0;
					t = 0;
					vy = v0y;
					if (movingplatform[i][level]) {
						onmovingplatform = true;
					}
				}
		}
		// end fall on platform

	
		
		
	}

function jumpkirby() 
  {
		var yi = 0;

		onmovingplatform = 0;

		onplatform = 0;

		t = t + 1;
		vy = v0y + (gravity * t * t) / 2;

		yi = ykirby;
		ykirby = y0 + vy * t;
		// y = y+vy*t;

		if (jumpright)
		{
			if (xkirby + kirbywidth >= screenwidth) 
			{
				xkirby = screenwidth - kirbywidth;
			} else
				xkirby = xkirby + 35;
		}
		if (jumpleft) {
			if (xkirby <= 0) {
				xkirby = 0;
			} else
				xkirby = xkirby - 35;
		}

		// jump on enemy ?

		// if (platform != i)
		for (var i = 0; i <= 3; i++)
			if (enemyExists[i][level])
				if ((xkirby >= xe[i][level] - 35) && (xkirby + kirbywidth <= xe[i][level] + kirbywidth + 35))
					// debug if ((y0+vy*t+kirbywidth >=yplatform[i]-35) && (y0+vy*t+kirbywidth <=
					// yplatform[i]+35))
					if (yi + kirbyheight <= ye[i][level] && ykirby + kirbyheight >= ye[i][level]) {
						// ?enemyDied = true;
						enemyExists[i][level] = false;
						if (enemySpitting[i][level])
						{
							startspitting[i] = 0;
							
						}
						
					
							playSound("die.wav");
				
					}

		// end jump on enemy

		// jump on platform ?
		for (var i = 0; i <= nrplatforms[level]; i++) {
			// if (platform != i)
			if ((xkirby >= xplatform[i][level] - 35)
					&& (xkirby + kirbywidth <= xplatform[i][level] + platformwidth[i] + 35))
				// debug if ((y0+vy*t+kirbywidth >=yplatform[i]-35) && (y0+vy*t+kirbywidth <=
				// yplatform[i]+35))
				if (yi + kirbyheight <= yplatform[i][level] && ykirby + kirbyheight >= yplatform[i][level]) {
					ykirby = yplatform[i][level] - kirbyheight;
					onplatform = 1;
					platform = i;
					jumpstarted = 0;
					jumpleft = 0;jumpright = 0; //v2
					t = 0;
					vy = v0y;
					if (movingplatform[i][level]) {
						onmovingplatform = 1;
					}
				}
		}
		// end jump on platform

		// jump up into ceiling ?
		for (var i = 0; i <= nrplatforms[level]; i++) {
			if ((xkirby >= xplatform[i][level] - 35)
					&& (xkirby + kirbywidth <= xplatform[i][level] + platformwidth[i] + 35))
				if (yi >= yplatform[i][level] + platformheight && ykirby <= yplatform[i][level] + platformheight) {
					ykirby = yplatform[i][level] + platformheight;
					jumpstarted = 0;
					jumpleft = 0;jumpright = 0; //v2
					t = 0;
					vy = 0;
					fallstart = 1;
				}
		}

		// end ceiling

	}


function coins()
{
	for (var i = 0; i < nrcoins[level]; i++) 
	if (coinAlive[i][level])
		{
			drawImage("imgCoin", coinx[i][level], coiny[i][level]);
		}
}

function doors()
{
	drawImage("imgDoor", xDoor[level - 1], yDoor[level - 1]);
}

function initDoors() 
  {
	for (var ilevel = 1;ilevel<=maxLevel;ilevel++)
	{

	
	if (ilevel == 1) 
	{
			xDoor[ilevel - 1] = screenwidth / 2; // screenwidth - 75;
			yDoor[ilevel - 1] = 300;
			
		}

		if (ilevel == 2) 
		{
			xDoor[ilevel - 1] = xplatform[3][ilevel] + 40;
			yDoor[ilevel - 1] = yplatform[3][ilevel] - doorHeight;
			
		}

		

		if (ilevel == 3) 
		{
			xDoor[ilevel - 1] = screenwidth / 2; // screenwidth - 75;
			yDoor[ilevel - 1] = 300;
			
		}

		if (ilevel == 4) 
		{
			xDoor[ilevel - 1] = screenwidth / 2; // screenwidth - 75;
			yDoor[ilevel - 1] = 225 - doorHeight;
		}

		if (ilevel == 5) {
			xDoor[ilevel - 1] = screenwidth / 2; // screenwidth - 75;
			yDoor[ilevel - 1] = 300;
		

			
		}

		if (ilevel == 6) {
			xDoor[ilevel - 1] = screenwidth / 2; // screenwidth - 75;
			yDoor[ilevel - 1] = 300;
	

			
		}

		if (ilevel == 7) 
		{
			xDoor[ilevel - 1] = screenwidth / 2; // screenwidth - 75;
			yDoor[ilevel - 1] = 300;			
		}

		if (ilevel == 8)
		{
			xDoor[ilevel - 1] = xplatform[2][ilevel] + platformwidth[2]/2;
			yDoor[ilevel - 1] = yplatform[2][ilevel] - doorHeight;		
		}

		if (ilevel == 9)
		{
			xDoor[ilevel - 1] = xplatform[2][ilevel] + platformwidth[2]/2;
			yDoor[ilevel - 1] = yplatform[2][ilevel] - doorHeight;		
		}
	}

	}

  function platforms() {
		// moving platform
		for (var i = 1; i <= nrplatforms[level]; i++) {
			if (movingplatform[i][level])
			{

				if (platformdirection[i][level] < 0)
				 {
					xplatform[i][level] -= 5;
					if (onmovingplatform) {
						
						xkirby -= 5;
					}
					if (onmovingplatformb) {
						xb -= 5;
					}
					if (xplatform[i][level] <= platformminx[i][level]) {

						platformdirection[i][level] = 1;
					}
				} else {
					xplatform[i][level] += 5;
					if (onmovingplatform) {
						
						xkirby += 5;
					}
					if (onmovingplatformb) {
						xb += 5;
					}
					if (xplatform[i][level] >= platformmaxx[i][level]) {
						platformdirection[i][level] = -1;
					}

				}

//    		//platform hits kirby
//    		if (ykirby>=yplatform[i][level]+platformheight -5 && ykirby<=yplatform[i][level]+platformheight + 5)
//    		if ((xplatform[i][level]<=xkirby+kirbywidth +5 && xplatform[i][level] >= xkirby-5)||(xplatform[i][level]+kirbywidth >=xkirby - 5 && xplatform[i][level]+kirbywidth <= xkirby + 5))
//    		{
//    			 g.drawImage(imgBlank, xkirby, ykirby, null);
//    			 getContentPane().repaint();
//    			 xkirby = 0;ykirby=300;
//    			 lifeKirby.setValue(lifeKirby.getValue()-33);
//    			 new Thread(() -> {
//    		          playSound("sounds/die.wav");
//    		      }).start();
//    		}//end hits kirby
//    		
//    		//platform hits bandana
//    			if (yb>=yplatform[i][level]+platformheight -5 && yb<=yplatform[i][level]+platformheight + 5)
//    			if ((xplatform[i][level]<=xb+bandanawidth +5 && xplatform[i][level] >= xb-5)||(xplatform[i][level]+bandanawidth >=xb - 5 && xplatform[i][level]+bandanawidth <= xb + 5))
//    			{
//    				 g.drawImage(imgBlank, xb, yb, null);
//    				 getContentPane().repaint();
//    				 xb = screenwidth-bandanawidth;ykirby=300;
//    				 pbBandana.setValue(pbBandana.getValue()-33);
//    				 new Thread(() -> {
//    			          playSound("sounds/die.wav");
//    			      }).start();
//    			}//end hits bandana

			} // end movingplatform

		}

		

		for (var i = 1; i <= nrplatforms[level]; i++) 
		{
			drawImage(getImgPlatformForWorld(world), xplatform[i][level], yplatform[i][level]);
		}

	}

function getImgPlatformForWorld(world)
{
	var res;
	if (world == 1)
		res = "imgPlatform";
	if (world == 2)
		res = "imgPlatformIce";

	return res;
}

  function initcoins() {
		// level 1
		coinx[0][1] = 125;
		coiny[0][1] = 300;

		coinx[1][1] = 250;
		coiny[1][1] = 300;

		coinx[2][1] = 400;
		coiny[2][1] = 300;

		// level 2
		coinx[0][2] = 200;
		coiny[0][2] = 300;

		coinx[1][2] = 280; //xplatform[2][2] + platformwidth[2] / 2 - coinwidth / 2;// 300;
		coiny[1][2] = yplatform[2][2] - kirbyheight; // 300

		coinx[2][2] = 450;
		coiny[2][2] = 300;

		// level 3
		coinx[0][3] = 125;
		coiny[0][3] = 300;

		coinx[1][3] = 250;
		coiny[1][3] = 300;

		coinx[2][3] = 400;
		coiny[2][3] = 300;


		//level 8
		for (var i=0;i<nrcoins[8];i++)
		{
			coinx[i][8] = -25 + xplatform[i+1][8]+platformwidth[i+1]/2; //first platorm is platform 0
			coiny[i][8] = yplatform[i+1][8] - coinwidth;
		}

		//level 9
		for (var i=0;i<nrcoins[9];i++)
		{
			coinx[i][9] = -25 + xplatform[i+1][9]+platformwidth[i+1]/2; //first platorm is platform 0
			coiny[i][9] = yplatform[i+1][9] - coinwidth;
		}

		for (j = 1;j<=maxLevel;j++)
		for (var i = 0;i<nrcoins[level];i++)
		{
			coinAlive[i][j] = 1;
		}
	}

  function initplatforms() {
		// level 1
		yplatform[0][1] = groundy;
		yplatform[1][1] = 225;
		yplatform[2][1] = 140;
		yplatform[3][1] = 225;

		xplatform[0][1] = 0;
		xplatform[1][1] = 150;
		xplatform[2][1] = 300;
		xplatform[3][1] = 430;

		// level 2
		yplatform[0][2] = groundy;
		yplatform[1][2] = 225;
		yplatform[2][2] = 150;
		yplatform[3][2] = 80;

		xplatform[0][2] = 0;
		xplatform[1][2] = 150;
		xplatform[2][2] = 250;
		xplatform[3][2] = 350;

		// level 3
		yplatform[0][3] = groundy;
		yplatform[1][3] = 225;
		yplatform[2][3] = 140;
		yplatform[3][3] = 225;

		xplatform[0][3] = 0;
		xplatform[1][3] = 150;
		xplatform[2][3] = 300;
		xplatform[3][3] = 430;

		// level 4
		yplatform[0][4] = groundy;
		yplatform[1][4] = 225;
		yplatform[2][4] = 225;
		yplatform[3][4] = 225;

		xplatform[0][4] = 0;
		xplatform[1][4] = 150;
		xplatform[2][4] = 300;
		xplatform[3][4] = 430;

		//...

		//level 8
		yplatform[0][8] = groundy;
		yplatform[1][8] = 225;
		yplatform[2][8] = 75;
		yplatform[3][8] = 225;

		xplatform[0][8] = 0;
		xplatform[1][8] = 150;
		xplatform[2][8] = 150;
		xplatform[3][8] = 430;

		//level 9
		yplatform[0][9] = groundy;
		yplatform[1][9] = 225;
		yplatform[2][9] = 75;
		yplatform[3][9] = 225;

		xplatform[0][9] = 0;
		xplatform[1][9] = 150;
		xplatform[2][9] = 430;
		xplatform[3][9] = 430;



		// level 1
		movingplatform[0][1] = false;
		movingplatform[1][1] = false;
		movingplatform[2][1] = false;
		movingplatform[3][1] = false;

		// level 2
		movingplatform[0][2] = false;
		movingplatform[1][2] = false;
		movingplatform[2][2] = true;
		movingplatform[3][2] = false;

		// level 3
		movingplatform[0][3] = false;
		movingplatform[1][3] = true;
		movingplatform[2][3] = false;
		movingplatform[3][3] = false;

		// level 4
		movingplatform[0][4] = false;
		movingplatform[1][4] = false;
		movingplatform[2][4] = false;
		movingplatform[3][4] = false;

		// level 1
		platformmaxx[0][1] = xplatform[0][1] + platformrange;
		platformmaxx[1][1] = xplatform[1][1] + platformrange;
		;
		platformmaxx[2][1] = xplatform[2][1] + platformrange;
		;
		platformmaxx[3][1] = xplatform[3][1] + platformrange;
		;

		// level 2
		platformmaxx[0][2] = xplatform[0][2] + platformrange;
		;
		platformmaxx[1][2] = xplatform[1][2] + platformrange;
		;
		platformmaxx[2][2] = xplatform[2][2] + platformrange;
		;
		platformmaxx[3][2] = xplatform[3][2] + platformrange;
		;

		// level 3
		platformmaxx[0][3] = xplatform[0][3] + platformrange;
		;
		platformmaxx[1][3] = xplatform[1][3] + platformrange;
		;
		platformmaxx[2][3] = xplatform[2][3] + platformrange;
		;
		platformmaxx[3][3] = xplatform[3][3] + platformrange;
		;

		// level 4
		platformmaxx[0][4] = 0;
		;
		platformmaxx[1][4] = 0;
		;
		platformmaxx[2][4] = 0;
		;
		platformmaxx[3][4] = 0;
		;

		// level 1
		platformminx[0][1] = xplatform[0][1];
		platformminx[1][1] = xplatform[1][1];
		platformminx[2][1] = xplatform[2][1];
		platformminx[3][1] = xplatform[3][1];

		// level 2
		platformminx[0][2] = xplatform[0][2];
		platformminx[1][2] = xplatform[1][2];
		platformminx[2][2] = xplatform[2][2];
		platformminx[3][2] = xplatform[3][2];

		// level 3
		platformminx[0][3] = xplatform[0][3];
		platformminx[1][3] = xplatform[1][3];
		platformminx[2][3] = xplatform[2][3];
		platformminx[3][3] = xplatform[3][3];

		// level 4
		platformminx[0][4] = 0;
		platformminx[1][4] = 0;
		platformminx[2][4] = 0;
		platformminx[3][4] = 0;

		// level 1
		platformdirection[0][1] = -1;
		platformdirection[1][1] = -1;
		platformdirection[2][1] = -1;
		platformdirection[3][1] = -1;

		// level 2
		platformdirection[0][2] = -1;
		platformdirection[1][2] = -1;
		platformdirection[2][2] = -1;
		platformdirection[3][2] = -1;

		// level 3
		platformdirection[0][3] = -1;
		platformdirection[1][3] = -1;
		platformdirection[2][3] = -1;
		platformdirection[3][3] = -1;

		// level 4
		platformdirection[0][4] = 0;
		platformdirection[1][4] = 0;
		platformdirection[2][4] = 0;
		platformdirection[3][4] = 0;
	}


  function initlevel() {
	if (world == 2)
	{
	var c = document.getElementById("canvas1");
	c.setAttribute("style","background-color:#C0E0FF;top:0;left:0;");	
	}
	if (world == 1)
	{
		var c = document.getElementById("canvas1");
		c.setAttribute("style","background-color:#00A2E8;top:0;left:0;");	
	}

	
		
		bombNo = 0;
		
		
		xkirby = xinit+25; //v10 
		if (!hashat && !hasbomb && !hasice)
		{
			ykirby = yinit;
		}
		if (hashat ||  hasice) 
		{
			ykirby = yinit - (kirbyfireheight - kirbyinitialheight);
		}
		if(hasbomb)
		{
			ykirby = yinit - (kirbybombheight - kirbyinitialheight);
		}
		xb = xbinit; // screenwidth-kirbywidth;
		yb = ybinit;
		platform = 0;
		onplatform = 1;
		
		platformb = 0;
		onplatformb = 1;

		onmovingplatform = 0;
		onmovingplatformb = 0;
		for (var i = 0; i <= 3; i++) 
		{
			aspiring[i] = false;
			setEnemyImage(i, level, enemydirection[i][level], 0, 0, 0);
		}

		if (level == firstworldmaxlevel ) 
		{
			
			x = document.getElementById('mySound');
			x.pause();
			x.setAttribute("src", "sounds/dangerous.mp3")
  			x.play();

		}

		
		
	}

function killKirby()
{
	kirbyFrozen = false;
	kirbyFrozenCounter = 0;

	xkirby = xinit;


	//lose ability when killed ?
	/*
	ykirby = yinit;
	hashat = false; hasice = false; hasbomb = false;
	kirbyheight = kirbyinitialheight;
	imgCurrent = "img";
	*/

	ykirby = yinit;
	if (hashat ||  hasice) 
	{
		ykirby = yinit - (kirbyfireheight - kirbyinitialheight);
	}
	if(hasbomb)
	{
		ykirby = yinit - (kirbybombheight - kirbyinitialheight);
	}

	setKirbyCurrentImage(false);
	currentLifeKirby = document.getElementById("lifeKirby").getAttribute('value');
	document.getElementById("lifeKirby").setAttribute('value', currentLifeKirby - lifePiece) ;
					
	playSound("die.wav");
}

function setEnemyImage(i, level, direction, aspiring, frozen, horizontal)
{
	if  (!horizontal)
	{
	if (direction == 1 && !aspiring && !frozen)
	{
		imgEnemyCurrent[i] = "imgEnemyRight";
								
		//if (enemyFrozen[i][level])
		//	imgEnemyCurrent[i] = "imgRightFrozen";
		if (enemySpitting[i][level]) 
		{
			imgEnemyCurrent[i] = "imgHotHeadRight";
		} 
								
		if(enemyBomb[i][level])
		{
			imgEnemyCurrent[i] = "imgPoppy";
		}
		if (enemyIce[i][level])
		{
			imgEnemyCurrent[i] = "imgChillyRight";
		} 
	}

	if (direction == -1 && !aspiring && !frozen)
	{
		imgEnemyCurrent[i] = "imgEnemyLeft";
							
		//if (enemyFrozen[i][level])
		//	imgEnemyCurrent[i] = "imgLeftFrozen";
		if (enemySpitting[i][level]) 
		{
			imgEnemyCurrent[i] = "imgHotHeadLeft";
		} 
		if(enemyBomb[i][level])
		{
			imgEnemyCurrent[i] = "imgPoppy";
		}
		if (enemyIce[i][level]) 
		{
			imgEnemyCurrent[i] = "imgChillyLeft";
		} 
	}
	}

	if (horizontal)
	{
		// imgEnemyCurrent[i] = imgEnemyHorizontal;
		if (enemySpitting[i][level])
		{
			imgEnemyCurrent[i] = "imgHotHeadHorizontal";
		} else 
		{
			imgEnemyCurrent[i] = "imgEnemyHorizontal";
		}
		if(enemyBomb[i][level])
		{
			imgEnemyCurrent[i] = "imgPoppyHorizontal";
		}
		if(enemyIce[i][level])
		{
			imgEnemyCurrent[i] = "imgChillyHorizontal";
		}
		if (world == 2)
		{
			imgEnemyCurrent[i] = "imgPokesonHorizontal";
		}
	}

}

//////////////// ENEMY
function enemy() {
  	   

		for (var i = 0; i <= 3; i++) 
		{
			if (enemyExists[i][level]) 
			{
				
				if (!aspiring[i])
				{

					if (enemydirection[i][level] < 0) 
					{
						
						if (!enemyFrozen[i][level])
							xe[i][level] -= 5;

						if (xe[i][level] <= enemyminx[i][level])
							if (!enemyFrozen[i][level])
							{
								setEnemyImage(i, level, 1, 0, 0);
								enemydirection[i][level] = 1;
							}
					} else 
						{
						
						if (!enemyFrozen[i][level])
							xe[i][level] += 5;
						
						if (xe[i][level] >= enemymaxx[i][level])
							if (!enemyFrozen[i][level])
						{
							setEnemyImage(i, level, -1, 0, 0);
							enemydirection[i][level] = -1;
						}

					}
					
					if (world == 2)
					{
						imgEnemyCurrent[i] = "imgPokeson";
					}

					// spit
					if (!enemyFrozen[i][level])
					if (!startspitting[i] && (enemySpitting[i][level] || enemyBomb[i][level] || enemyIce[i][level]))
					 {
						startspitting[i] = true;
						//v5 angle = 0;
						xspit[i] = xe[i][level];
						if (!enemyBomb[i][level])
							yspit[i] = ye[i][level] + enemymouthy;
						else
							yspit[i] = ye[i][level]+enemyheight-bombheight;
						spitdirection[i] = enemydirection[i][level];
					}

					if (startspitting[i]) 
					{
						
						xspit[i] += 10 * spitdirection[i];
						
						
						// shoot kirby
						//
						enemyShootsKirby(i);
						//

						// shoot bandana
						//
						enemyShootsBandana(i);
						//
						

						if (xspit[i] < 0 || xspit[i] > screenwidth) 
						{

							startspitting[i] = false;
						}

					}
					//

					// eat kirby
					//
					enemyEatsKirby(i);
					//
					

					// eat Bandana
					//
					enemyEatsBandana(i);
					//
					

				} // end not aspiring

				// enemy aspired
				enemyAspired(i);
				//


					 //***
				
					if ((enemySpitting[i][level] || enemyIce[i][level])&& startspitting[i] && !enemyBomb[i][level]) 
					{
						if (enemySpitting[i][level])
						{
							if (spitdirection[i] == -1) {
								drawImage("imgSpitLeft", xspit[i], yspit[i]);
							} else {
								drawImage("imgSpitRight", xspit[i], yspit[i]);
							}
						}
						if (enemyIce[i][level])
						{
							if (spitdirection[i] == -1) {
								drawImage("imgIceSpitLeft", xspit[i], yspit[i]); //TODO
							} else {
								drawImage("imgIceSpitRight", xspit[i], yspit[i]); //TODO
							}
						}
					}
					if (enemySpitting[i][level] && startspitting[i] && enemyBomb[i][level]) 
					{
						angleE[i] += 90;
						if (angleE[i] == 360)
						{
							angleE[i] = 0;
						}
						drawRotatedBombE( xspit[i], yspit[i], angleE[i]);
					}
					drawImage(imgEnemyCurrent[i], xe[i][level], ye[i][level]);
			}  // end enemy exists
			
		}

		
	}
/////////////// END ENEMY

function kirbyGetsAbility(i)
{
	//v11
	if (enemySpitting[i][level] && !enemyBomb[i][level] ) 
							{
								hashat = 1;
								
								ykirby = ykirby - (kirbyfireheight - kirbyheight);
								kirbyheight = kirbyfireheight;
							}
							if (enemyBomb[i][level] )
							{
								hasbomb = 1;
								
								ykirby = ykirby - (kirbybombheight - kirbyheight);
								kirbyheight = kirbybombheight;
							}
							if (enemyIce[i][level] )
							{
								
								
								
								if  (!hasice)
								{
									ykirby = ykirby - (kirbyfireheight - kirbyinitialheight);
								}
								kirbyheight = kirbyfireheight;
								
								if (!hasice)
								{
									y0 = ykirby; // oare ??
								}
									
								hasice = 1;
							}
							//
}

function enemyShootsKirby(i)
{
	if (collision(xkirby, kirbywidth, xspit[i], spitwidth, ykirby, kirbyheight, yspit[i], spitheight))
						{
							startspitting[i] = false;

							if (enemyIce[i][level]) 
							{
								imgCurrent = "imgKirbyFrozen";
								if (hasbomb && !kirbyFrozen)
								{
									ykirby = ykirby + (kirbybombheight - kirbyinitialheight);
								}
								if (hasice && !kirbyFrozen)
								{
									ykirby = ykirby + (kirbyiceheight - kirbyinitialheight);
								}	
								if (hashat && !kirbyFrozen)
								{
									ykirby = ykirby + (kirbyfireheight - kirbyinitialheight);
								}	
								kirbyFrozen = true;
							}
							else //kill kirby
							{
								killKirby();
							}
						}
}

function enemyShootsBandana(i)
{
	if (Math.abs(xb + bandanawidth / 2 - xspit[i]) <= 10
								&& Math.abs(yb + bandanaheight / 2 - yspit[i]) <= 40) 
						{
							
							xb = xbinit;
							yb = ybinit;
						//	pbBandana.setValue(pbBandana.getValue() - 33);
						currentLifeBandana = document.getElementById("pbBandana").getAttribute('value');
						document.getElementById("pbBandana").setAttribute('value', currentLifeBandana - lifePiece) ;
						
								playSound("die.wav");
						

							startspitting[i] = false;
						}
}

function enemyEatsKirby(i)
{
	if (collision(xkirby, kirbywidth, xe[i][level], enemywidth, ykirby, kirbyheight, ye[i][level], enemyheight))
						{
							if (!enemyFrozen[i][level])
							{
								killKirby();
							} 
							else //move frozen enemy
							{
								if (xe[i][level] <= xkirby + kirbywidth + 5 && xe[i][level] >= xkirby - 5)
								{
									xe[i][level] = xkirby+kirbywidth;
								}
								if (xe[i][level] + kirbywidth >= xkirby - 5
										&& xe[i][level] + kirbywidth <= xkirby + 5)
								{
									xe[i][level] = xkirby - enemywidth;
								}
							}
						} // end eat kirby
}

function enemyEatsBandana(i)
{
	if (yb + bandanaheight == ye[i][level] + enemyheight)
						if ((xe[i][level] <= xb + bandanawidth + 5 && xe[i][level] >= xb - 5)
								|| (xe[i][level] + bandanawidth >= xb - 5 && xe[i][level] + bandanawidth <= xb + 5)) {
							if (imgCurrentBandana == "imgBandana")
								drawImage(imgBlankE, xb, yb, null);
							else
								drawImage(imgBlankB, xb, yb, null);
							xb = screenwidth - bandanawidth;
							yb = 300;
							pbBandana.setValue(pbBandana.getValue() - lifePiece);
							
								playSound("die.wav");
					
						} // end eat bandana
}

function enemyAspired(i)
{
	if (aspiring[i]) 
				{

					

					if (xkirby <= xe[i][level] ) 
					{
						if (xe[i][level] <= xkirby + kirbywidth + 5)
						 {
							aspiring[i] = 0;

							////////
							kirbyGetsAbility(i);
							////////
							
							enemyExists[i][level] = false;
							if (enemySpitting[i][level])
							{
								startspitting[i] = 0;
								
							}
							setKirbyCurrentImage(0);

						
								playSound("die.wav");
					
						} else 
						{
							xe[i][level] -= 15;
						}
					} else 
					{
						if (xe[i][level] + kirbywidth >= xkirby - 5) 
						{
							aspiring[i] = 0;
							//
							kirbyGetsAbility(i);
							//
							enemyExists[i][level] = false;
							if (enemySpitting[i][level])
							{
								startspitting[i] = 0;
							}
							setKirbyCurrentImage(0);
						
								playSound("die.wav");
						
						} else 
						{
							xe[i][level] += 15;
						}
					}
				}
}

function initenemies() {
		// level 1
		enemyExists[0][1] = false;
		enemyExists[1][1] = false;
		enemyExists[2][1] = false;
		enemyExists[3][1] = false;

		// level 2
		enemyExists[0][2] = false;
		enemyExists[1][2] = false;
		enemyExists[2][2] = false;
		enemyExists[3][2] = false;

		// level 3
		enemyExists[0][3] = false;
		enemyExists[1][3] = true;
		enemyExists[2][3] = false;
		enemyExists[3][3] = false;

		// level 4
		enemyExists[0][4] = false;
		enemyExists[1][4] = true;
		enemyExists[2][4] = true;
		enemyExists[3][4] = false;

		// level 1
		enemySpitting[0][1] = false;
		enemySpitting[1][1] = false;
		enemySpitting[2][1] = false;
		enemySpitting[3][1] = false;

		// level 2
		enemySpitting[0][2] = false;
		enemySpitting[1][2] = false;
		enemySpitting[2][2] = false;
		enemySpitting[3][2] = false;

		// level 3
		enemySpitting[0][3] = false;
		enemySpitting[1][3] = false;
		enemySpitting[2][3] = false;
		enemySpitting[3][3] = false;

		// level 4
		enemySpitting[0][4] = false;
		enemySpitting[1][4] = false;
		enemySpitting[2][4] = false;
		enemySpitting[3][4] = false;

		enemyIce[0][4] = false;
		enemyIce[1][4] = true;
		enemyIce[2][4] = true;
		enemyIce[3][4] = false;


		// level 1
		enemydirection[0][1] = -1;
		enemydirection[1][1] = -1;
		enemydirection[2][1] = -1;
		enemydirection[3][1] = -1;

		// level 2
		enemydirection[0][2] = -1;
		enemydirection[1][2] = -1;
		enemydirection[2][2] = -1;
		enemydirection[3][2] = -1;

		// level 3
		enemydirection[0][3] = -1;
		enemydirection[1][3] = -1;
		enemydirection[2][3] = 1;
		enemydirection[3][3] = -1;

		// level 4
		enemydirection[0][4] = -1;
		enemydirection[1][4] = -1;
		enemydirection[2][4] = 1;
		enemydirection[3][4] = -1;

		// level 1
		xe[0][1] = 300;
		xe[1][1] = 300;
		xe[2][1] = 300;
		xe[3][1] = 300;

		// level 2
		xe[0][2] = 300;
		xe[1][2] = 300;
		xe[2][2] = 300;
		xe[3][2] = 300;

		// level 3
		xe[0][3] = 300;
		xe[1][3] = 300;
		xe[2][3] = 100;
		xe[3][3] = 300;

		// level 4
		xe[0][4] = 300;
		xe[1][4] = 500;
		xe[2][4] = 300;
		xe[3][4] = 300;

		// level 1
		ye[0][1] = 300;
		ye[1][1] = 300;
		ye[2][1] = 300;
		ye[3][1] = 300;

		// level 2
		ye[0][2] = 300;
		ye[1][2] = 300;
		ye[2][2] = 300;
		ye[3][2] = 300;

		// level 3
		ye[0][3] = 300;
		ye[1][3] = 300;
		ye[2][3] = 300;
		ye[3][3] = 300;

		// level 4
		ye[0][4] = yplatform[0][4] - 75;
		ye[1][4] = yplatform[1][4] - 75;
		ye[2][4] = yplatform[2][4] - 75;
		ye[3][4] = yplatform[3][4] - 75;

		// level 1
		enemymaxx[0][1] = xe[0][1] + platformrange;
		enemymaxx[1][1] = xe[1][1] + platformrange;
		enemymaxx[2][1] = xe[2][1] + platformrange;
		enemymaxx[3][1] = xe[3][1] + platformrange;

		// level 2
		enemymaxx[0][2] = xe[0][2] + platformrange;
		enemymaxx[1][2] = xe[1][2] + platformrange;
		enemymaxx[2][2] = xe[2][2] + platformrange;
		enemymaxx[3][2] = xe[3][2] + platformrange;

		// level 3
		enemymaxx[0][3] = xe[0][3] + platformrange;
		enemymaxx[1][3] = xe[1][3];
		enemymaxx[2][3] = xe[2][3] + platformrange;
		enemymaxx[3][3] = xe[3][3] + platformrange;

		// level 4
		enemymaxx[0][4] = xe[0][4] + platformrange;
		enemymaxx[1][4] = xe[1][4];
		enemymaxx[2][4] = xe[2][4] + platformrange;
		enemymaxx[3][4] = xe[3][4] + platformrange;

		// level 1
		enemyminx[0][1] = xe[0][1];
		enemyminx[1][1] = xe[1][1];
		enemyminx[2][1] = xe[2][1];
		enemyminx[3][1] = xe[3][1];

		// level 2
		enemyminx[0][2] = xe[0][2];
		enemyminx[1][2] = xe[0][2];
		enemyminx[2][2] = xe[2][2];
		enemyminx[3][2] = xe[3][2];

		// level 3
		enemyminx[0][3] = xe[0][3];
		enemyminx[1][3] = xe[1][3] - platformrange;
		enemyminx[2][3] = xe[2][3];
		enemyminx[3][3] = xe[3][3];

		// level 4
		enemyminx[0][4] = xe[0][4];
		enemyminx[1][4] = xe[1][4] - platformrange;
		enemyminx[2][4] = xe[2][4];
		enemyminx[3][4] = xe[3][4];

	}


  function level5() {
		copylevel(4, 5, 1);
		enemyExists[3][5] = true;
		enemyminx[3][5] = 100;
		enemymaxx[3][5] = 100 + platformrange;
		xe[3][5] = 300;
		ye[3][5] = 300;

		enemySpitting[3][5] = true;
	}

	function level6() {
		copylevel(5, 6, 1);
		enemyBomb[3][6] = true;

		enemySpitting[1][6] = true;
		enemySpitting[2][6] = true;

		enemyBomb[1][6] = true;
		enemyBomb[2][6] = true;
	}

	function level7()
	{
		copylevel(6, 7, 0);
		enemyExists[3][7] = false;

		enemyExists[1][7] = false;
		enemyExists[2][7] = false;

	}

	function level8()
	{
		copyEnemies(4, 8);
	}

	function level9()
	{
		copyEnemies(4, 9);
	}


  function copylevel(levelSource, levelDest, platforms) 
  {

// copy coins
for (var i = 0; i <= 2; i++) 
{
  coinx[i][levelDest] = coinx[i][levelSource];
  coiny[i][levelDest] = coiny[i][levelSource];
}

// copy platforms
//platform 0 is the ground - it has to be copied in any case !!
  xplatform[0][levelDest] = xplatform[0][levelSource];
  yplatform[0][levelDest] = yplatform[0][levelSource];

if (platforms == 1)
for (var i = 1; i <= 3; i++) 
{
  xplatform[i][levelDest] = xplatform[i][levelSource];
  yplatform[i][levelDest] = yplatform[i][levelSource];
  movingplatform[i][levelDest] = movingplatform[i][levelSource];
  platformminx[i][levelDest] = platformminx[i][levelSource];
  platformmaxx[i][levelDest] = platformmaxx[i][levelSource];
  platformdirection[i][levelDest] = platformdirection[i][levelSource];
}

// copy enemies
for (var i = 0; i <= 3; i++) {
  xe[i][levelDest] = xe[i][levelSource];
  ye[i][levelDest] = ye[i][levelSource];
  enemyExists[i][levelDest] = enemyExists[i][levelSource];
  enemydirection[i][levelDest] = enemydirection[i][levelSource];
  enemymaxx[i][levelDest] = enemymaxx[i][levelSource];
  enemyminx[i][levelDest] = enemyminx[i][levelSource];
  enemySpitting[i][levelDest] = enemySpitting[i][levelSource];
}

}


function copyEnemies(levelSource, levelDest)
{
// copy enemies
for (var i = 0; i <= 3; i++) {
  xe[i][levelDest] = xe[i][levelSource];
  ye[i][levelDest] = ye[i][levelSource];
  enemyExists[i][levelDest] = enemyExists[i][levelSource];
  enemydirection[i][levelDest] = enemydirection[i][levelSource];
  enemymaxx[i][levelDest] = enemymaxx[i][levelSource];
  enemyminx[i][levelDest] = enemyminx[i][levelSource];
  enemySpitting[i][levelDest] = enemySpitting[i][levelSource];
}
}

function whispywoods()
	{
		if (level == firstworldmaxlevel) //maxLevel
		{
			if (whispyAlive)
			{
				drawImage("imgWhispy", xwhispy, ywhispy);
			}
			else
			{
				return;
			}

			if (whispyFrozen)
			{
				return;
			}
			
			
			// apple kills kirby
			if (collision(xkirby, kirbywidth, xapple, applewidth, ykirby, kirbyheight, yapple, appleheight))
				{
					killKirby();
				} 
			
			if (yapple>=280) 
			{   
				yapple = y0apple;
				xapple =  150+Math.floor(Math.random() * 250);
			}
			else 
			{
				yapple += 5;
				drawImage("imgApple", xapple, yapple);
			}
		}
	}

    function InitGame()
     {  
     
    level = 1; //1 debugstefan 
	
	initplatforms();
	initDoors();
    initcoins();
	initenemies();

    level5();
	level6();
    level7();
	level8();
	level9();
   
   
	idling = false;
	idletime = 0;

    imgCurrent = "img";
    imgCurrentBandana = "imgBandana";
    imgCurrentWaddle = "imgCaged";
    
	
  
   displayLevel(level);

   funcSetInterval = setInterval(gameLoop, gameSpeed);//60 //100
         
   }


  function displayLevel(displayedLevel)
  {
	document.getElementById("lblLevel").innerText = "Level: " + displayedLevel;
  }
    
   

   function _DoMovement()
        {
            if (bool_moveLeft) MoveLeft();
            if (bool_moveRight) MoveRight();
        }
      
    function _DoMovementb()
      {
          if (bool_moveLeftb) MoveLeftb();
          if (bool_moveRightb) MoveRightb();
      }
      
      function MoveLeft() 
	{


// kirby hits bandana left
if (ykirby + kirbyheight == yb + bandanaheight)
  // if ((xkirby<=xb+bandanawidth +5 && xkirby >= xb-5)||(xkirby+kirbywidth >=xb -
  // 5 && xkirby+kirbywidth <= xb + 5))
  // if ((xkirby <= xb +bandanawidth + 5) && (xkirby >= xb + bandanawidth - 5))
  if (Math.abs(xkirby - xb - bandanawidth) <= 5) {
   // drawImage(imgCurrent, xkirby, ykirby);
    //getContentPane().repaint(); // don't forget to repaint the container
    return;
  } // end kirby hits banana left

  //kirby hits platform
for (var i = 1; i < 4; i++)
  if (ykirby <= yplatform[i][level] + platformheight && ykirby >= yplatform[i][level]
      && xkirby <= xplatform[i][level] + platformwidth[i] + 5
      && xkirby >= xplatform[i][level] + platformwidth[i] - 5) 
  {
	xkirby += 10;
    return;
  }

if (xkirby > 0) 
{
  //xkirby -= 10;
  if ((onplatform) && (xkirby + kirbywidth <= xplatform[platform][level] - 5)) 
  {
    fallstart = 1;
    ykirby = y0;
    v0y = 0;
  }
}
else
		{
			/*
			bool_moveLeft = 0;
			speedx = 0;
			*/
			//oare ?
			if (level>1)
			{
				level--;
				jumpLevel();
				xkirby = screenwidth - kirbywidth;
			}
			else
			{
				bool_moveLeft = 0;
				speedx = 0;
			}
		}

}

       function MoveRight()
        {
      

     

        // kirby hits bandana right
        if (ykirby + kirbyheight == yb + bandanaheight)
          // if ((xkirby<=xb+bandanawidth +5 && xkirby >= xb-5)||(xkirby+kirbywidth >=xb -
          // 5 && xkirby+kirbywidth <= xb + 5))
          if (Math.abs(xkirby + kirbywidth - xb) <= 5)
          // if (xkirby < xb-kirbywidth)
          // if (Math.abs(xkirby+kirbywidth/2 - (xb+bandanawidth/2))<=25)
          {
            // xkirby = xkirby - 25;
          //  drawImage(imgCurrent, xkirby, ykirby);
          //	getContentPane().repaint(); // don't forget to repaint the container
            return;
          } // end kirby hits banana

        if (xkirby > screenwidth - kirbywidth) {
          // TODO
        }

		//kirby hits platform
        for (var i = 1; i < 4; i++)
          if (ykirby <= yplatform[i][level] + platformheight && ykirby >= yplatform[i][level]
              && xkirby + kirbywidth >= xplatform[i][level] - 5
              && xkirby + kirbywidth <= xplatform[i][level] + 5) 
		  {
			xkirby -= 10;
            return;
          }

        if (xkirby < screenwidth - kirbywidth) 
		{
          //xkirby += 10;

          if ((onplatform) && (xkirby >= xplatform[platform][level] + platformwidth[platform] + 5)) {
            fallstart = 1;
            ykirby = y0;
            v0y = 0;
          }
        }
		else
		{
			bool_moveRight = 0;
			speedx = 0;
		}
		  
       
                
        }
    
      

function MoveLeftb() {



// bandana hits kirby left
if (ykirby + kirbyheight == yb + bandanaheight)
  // if ((xkirby<=xb+bandanawidth +5 && xkirby >= xb-5)||(xkirby+kirbywidth >=xb -
  // 5 && xkirby+kirbywidth <= xb + 5))
  // if ((xb <= xkirby +kirbywidth + 5) && (xb >= xkirby + kirbywidth - 5))
  if (Math.abs(xb - xkirby - kirbywidth) <= 5) {
    drawImage(imgCurrentBandana, xb, yb);
    //getContentPane().repaint(); // don't forget to repaint the container
    return;
  } // end kirby hits banana left

for (var i = 1; i < 4; i++)
  if (yb <= yplatform[i][level] + platformheight && yb >= yplatform[i][level]
      && xb <= xplatform[i][level] + platformwidth[i] + 5
      && xb >= xplatform[i][level] + platformwidth[i] - 5) {
    drawImage(imgCurrentBandana, xb, yb);
    //getContentPane().repaint(); // don't forget to repaint the container
    return;
  }

if (xb > 0) {
  xb -= 10;
  if ((onplatformb) && (xb + bandanawidth <= xplatform[platformb][level] - 5)) {
    fallstartb = 1;
    yb = yb0;
    vb0y = 0;
  }
}
drawImage(imgCurrentBandana, xb, yb);
//getContentPane().repaint(); // don't forget to repaint the container
}

function MoveRightb() {

if (imgCurrentBandana == "imgBandana"){}
  // drawimage("imgBlankE", xb, yb);
else{}
  // drawimage("imgBlankE", xb, yb);
//getContentPane().repaint(); // don't forget to repaint the container

// kirby hits bandana right
if (ykirby + kirbyheight == yb + bandanaheight)
  // if ((xkirby<=xb+bandanawidth +5 && xkirby >= xb-5)||(xkirby+kirbywidth >=xb -
  // 5 && xkirby+kirbywidth <= xb + 5))
  if ((xb + bandanawidth >= xkirby - 5) && (xb + bandanawidth <= xkirby + 5))
  // if (xkirby < xb-kirbywidth)
  // if (Math.abs(xkirby+kirbywidth/2 - (xb+bandanawidth/2))<=25)
  {
    // xkirby = xkirby - 25;
    drawImage(imgCurrentBandana, xb, yb);
    //getContentPane().repaint(); // don't forget to repaint the container
    return;
  } // end kirby hits banana

if (xb > screenwidth - kirbywidth) {
  // TODO
}

for (var i = 1; i < 4; i++)
  if (yb <= yplatform[i][level] + platformheight && yb >= yplatform[i][level]
      && xb + kirbywidth >= xplatform[i][level] - 5 && xb + kirbywidth <= xplatform[i][level] + 5) {
    drawImage(imgCurrentBandana, xb, yb);
    //getContentPane().repaint(); // don't forget to repaint the container
    return;
  }
if (xb < screenwidth - kirbywidth) {
  xb += 10;

  if ((onplatformb) && (xb >= xplatform[platformb][level] + platformwidth[platformb] + 5)) {
    fallstartb = true;
    yb = yb0;
    vb0y = 0;
  }
}
drawImage(imgCurrentBandana, xb, yb);

}

        
        document.addEventListener('keyup', function(event)
        {
			gameKeys[event.keyCode] = (event.type == "keydown");
		
			idletime = 0;
			idletimeb = 0;

          if(event.keyCode == KEY_ENTER) 
		{
			if (hashat || hasice)
			{
			startspittingkirby = 0;
			}
			
		}

        

          if (event.keyCode == KEY_RIGHT) 
          {
			bool_moveRight = 0;
			speedx = 0;
		  }

          if (event.keyCode == KEY_LEFT) 
          {
			bool_moveLeft = 0;
			speedx = 0;
		  }
          if (event.keyCode == 65) {
			bool_moveLeftb = false;
		}

		if (event.keyCode == 68) {
			bool_moveRightb = false;

		}

        });


document.addEventListener('keydown', function(event) {
	event.preventDefault();

////
gameKeys = (gameKeys || []);
gameKeys[event.keyCode] = (event.type == "keydown");
////

			if  (timerstopped)
			{
				return;
			}
//bandana
		if (event.keyCode == 65  && !event.shiftKey) {
			imgCurrentBandana = "imgBandanaLeft";
			bool_moveLeftb = true;

		}
		if (event.keyCode == 68 && !event.shiftKey) {
			imgCurrentBandana = "imgBandanaRight";
			bool_moveRightb = true;

		}

    if (event.keyCode == 68 && event.shiftKey || event.keyCode == 16 && bool_moveRightb) {
			vb0y = -75;
			yb0 = yb;
			if (imgCurrentBandana == "imgBandana"){}
				// drawimage("imgBlankE", xb, yb);
			else{}
				// drawimage("imgBlankE", xb, yb);
			imgCurrentBandana = "imgBandanaRight";
			jumpstartedb = 1;
			jumprightb = 1;
			jumpleftb = 0;
			if (onplatformb)
				jumpfromplatformb = 1;
			else
				jumpfromplatformb = 0;
			
			//Sorina	playSound("jump.wav");
		
			return;
		}

		if (event.keyCode == 65 && event.shiftKey || event.keyCode == 16 && bool_moveLeftb) {
			vb0y = -75;
			yb0 = yb;
				
			imgCurrentBandana = "imgBandanaLeft";
			jumpstartedb = 1;
			jumpleftb = 1;
			jumprightb = 0;
			if (onplatformb)
				jumpfromplatformb = 1;
			else
				jumpfromplatformb = 0;
			
			//Sorina	playSound("jump.wav");
			
			return;
		}

//kirby
		if (kirbyFrozen)
		{
			return;
		}
              // shoot enemy event
		if (event.keyCode == KEY_ENTER)
		if (!idling)
		 {
			if (hashat)
			{
				startspittingkirby = 1;
				xspitkirby = xkirby;
				yspitkirby = ykirby + enemymouthy;
				spitdirectionkirby = kirbydirection;	
			}
			if (hasbomb)
			if (bombNo < 9)
			{
				bombNo++;
				angleK[bombNo] = 0;
				startspittingkirby = 1;
				if (kirbydirection == 1)
					xbombkirby[bombNo] = xkirby+kirbywidth;
				else
					xbombkirby[bombNo] = xkirby-bombwidth;
				ybombkirby[bombNo] = ykirby + kirbyheight - bombheight;
				bombdirectionkirby[bombNo] = kirbydirection;
				
			}
			if (hasice)
			{
				startspittingkirby = 1;
				xspitkirby = xkirby;
				yspitkirby = ykirby + enemymouthy;
				spitdirectionkirby = kirbydirection;
			}
		}

		//drop ability
		if (event.keyCode == KEY_DELETE)
		{
			imgCurrent = "img";
			kirbyheight = kirbyinitialheight;
			//ykirby = groundy - kirbyheight;
			if (hashat)
			{
				ykirby = ykirby +  (kirbyfireheight - kirbyinitialheight);
			}
			if (hasbomb)
			{
				ykirby = ykirby +  (kirbybombheight - kirbyinitialheight);
			}
			if (hasice)
			{
				ykirby = ykirby +  (kirbyiceheight - kirbyinitialheight);
			}
			
			hashat = 0;
			hasbomb = 0;
			hasice = 0;
			
		}


            //aspire
            if (event.keyCode == KEY_SPACE) 
			//can't aspire if it has ability
			if (!hashat && !hasbomb && !hasice)
			for (var i = 0; i <= 3; i++)
		   {
				if (
					enemyExists[i][level] 
				&& Math.abs(xkirby - xe[i][level]) <= aspiringrange
				&& (
					(kirbydirection == 1) && xkirby <= xe[i][level]
					||
					(kirbydirection == -1) && xkirby >= xe[1][level] 		
					)
				&& Math.abs(ykirby - ye[i][level]) <= 25
				) 
				{
					aspiring[i] = 1;
					
					
					setEnemyImage(i, level, 0, 1, 0, 1);
					setKirbyCurrentImage(1);
					
					break;
				}

			}

          _DoMovement();
		 _DoMovementb();
});

function start()
{
  document.getElementById('lblWorld').removeAttribute('hidden');

  document.getElementById('lblLifeKirby').removeAttribute('hidden');
  document.getElementById('lifeKirby').removeAttribute('hidden');

  document.getElementById('lblpbBandana').removeAttribute('hidden');
  document.getElementById('pbBandana').removeAttribute('hidden');
  
  document.getElementById('lblLevel').removeAttribute('hidden');
  document.getElementById('lblCoins').removeAttribute('hidden');

  document.getElementById('btnStart').setAttribute('hidden', 'true');
  document.getElementById('canvas1').removeAttribute('hidden');
  x = document.getElementById('mySound');
  x.play();
}

</script>
</head>
<body onload="InitGame();" >
  
  <table>
	<tr><td colspan="2"><div style="border: 1px;border-color: black;border-style: solid;caret-color: transparent" >
		Kirby : arrows to move, CTRL+arrow to jump, SPACE to aspire enemy, ENTER to fire.</br>
		DELETE to drop ability.</br>
		Bandana: A, D to move, SHIFT to jump.</br>
		Kill enemies by aspiring them or jumping on them.</br>
	</div></td></tr>

	<tr><td>
  <label id="lblLifeKirby" for="lifeKirbyfile" hidden>Life Kirby:</label> 
  </td><td>
  <progress id="lifeKirby" value="99" max="99" hidden></progress>   
  </td>
</tr>

<tr><td>
  <label id="lblpbBandana" for="pbBandanafile" hidden>Life Bandana:</label>
  </td><td> 
  <progress id="pbBandana" value="99" max="99" hidden></progress>  
</td></tr>

<tr><td colspan="2"><div id="lblLevel" hidden>Level: 1</div></td><td colspan="2"><div id="lblWorld" hidden>World: 1</div></td>
</tr> 
<tr><td colspan="2"><div id="lblCoins" hidden>Coins: 0</div></td><td></td>
</tr> 

</table>
  <input id = "btnStart" type="button" value="Start Game" onclick="start();" />
<canvas id = "canvas1" width=640 height = 450 style="background-color:#00A2E8;top:0;left:0;" hidden /> 

<EMBED SRC = "test2.mid" HIDDEN = "true" loop = "yes" volume="10" autostart="true">

<img id="imgGround" src="images/ground.bmp" alt="no" width="640" height="75" top="375" left="0" > 
<img id="imgWorld2" src="images/world2.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="img" src="images/kirbyt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyLeft" src="images/kirbyleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyRight" src="images/kirbyrightt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgCoin" src="images/coint.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgDoor" src="images/doort.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBandana" src="images/bandanat.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBandanaLeft" src="images/bandanaleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBandanaRight" src="images/bandanarightt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgPlatform" src="images/platformt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgPlatformIce" src="images/platformicet.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgEnemyRight" src="images/enemyrightt.png" alt="no" width="640" height="75" top="375" left="0">
<img id="imgEnemyLeft" src="images/enemyleftt.png" alt="no" width="640" height="75" top="375" left="0" >


<img id="imgEnemyHorizontal" src="images/enemyhorizontalt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgAspiringLeft" src="images/kirbyaspiringleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgAspiringRight" src="images/kirbyaspiringrightt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgSpitRight" src="images/spitright.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgSpitLeft" src="images/spitleft.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgHotHeadRight" src="images/hotheadrightt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgHotHeadLeft" src="images/hotheadleftt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgKirbyFire" src="images/kirbyfiret.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyFireLeft" src="images/kirbyfireleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyFireRight" src="images/kirbyfirerightt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgKirbyBomb" src="images/bombkirbyt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyBombLeft" src="images/bombkirbyleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyBombRight" src="images/bombkirbyrightt.png" alt="no" width="640" height="75" top="375" left="0" >



<img id="imgFireLeft" src="images/fireleft.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgFireRight" src="images/fireright.bmp" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgWhispy" src="images/whispywoodst.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgWhispyEmpty" src="images/whispywoodsemptyt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgApple" src="images/applet.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBlankApple" src="images/applemask.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgHotHeadHorizontal" src="images/hotheadhorizontalt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgVictory" src="images/victory.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgGameOver" src="images/gameover.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgCaged" src="images/caged.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgFree" src="images/free.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgPoppy" src="images/poppybros.jrt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgPoppyMask" src="images/poppybros.jrmask.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgPoppyHorizontal" src="images/poppybros.jrhorizontalt.png" alt="no" width="640" height="75" top="375" left="0" >



<img id="imgExplosion" src="images/explosion.bmp" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgBombK0" src="images/bombt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBombK90" src="images/bomb90t.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBombK180" src="images/bomb180t.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBombK270" src="images/bomb270t.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgBombE0" src="images/bombE0t.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBombE90" src="images/bombE90t.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBombE180" src="images/bombE180t.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgBombE270" src="images/bombE270t.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgChillyLeft" src="images/chillyleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgChillyRight" src="images/chillyrightt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgChillyHorizontal" src="images/chillyhorizontalt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgKirbyIceLeft" src="images/icekirbyleftt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyIceRight" src="images/icekirbyrightt.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgKirbyIce" src="images/icekirbyt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgLeftFrozen" src="images/enemylefttFrozen.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgRightFrozen" src="images/enemyrighttFrozen.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgIceLeft" src="images/iceleft.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgIceRight" src="images/iceright.bmp" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgIceSpitLeft" src="images/spiticeleft.bmp" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgIceSpitRight" src="images/spiticeright.bmp" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgKirbyFrozen" src="images/kirbyt_frozen.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgHotHeadFrozen" src="images/hotheadice.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgPoppyFrozen" src="images/poppybrosfrozen.jrt.png" alt="no" width="640" height="75" top="375" left="0" >

<img id="imgPokeson" src="images/pokeson.png" alt="no" width="640" height="75" top="375" left="0" >
<img id="imgPokesonHorizontal" src="images/pokesonhorizontal.png" alt="no" width="640" height="75" top="375" left="0" >


<audio controls id="mySound" loop>
  <source src="sounds/tunnel.mp3" type="audio/mp3" /> 
  <!-- <source src="sounds/arpegio3.mp3" type="audio/mp3" /> -->
  </audio>

<!--
<audio controls id="mySound">
  <source src="sound.mp3" type="audio/mp3">
  </audio>
  -->


</body>
</html>